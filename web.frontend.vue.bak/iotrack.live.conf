<VirtualHost *:80>
  ServerName iotrack.live
  ServerAlias www.iotrack.live

  ProxyPreserveHost On
  ProxyRequests Off

  # --- 1) Upgrade /socket.io/* to WebSocket when requested ---
  RewriteEngine On
  # some clients send "Connection: keep-alive, Upgrade"
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteCond %{HTTP:Connection} upgrade [NC]
  RewriteCond %{REQUEST_URI} ^/socket.io/ [NC]
  RewriteRule ^/socket.io/(.*)$  ws://127.0.0.1:4003/socket.io/$1  [P,L]

  # --- 2) Fallback to HTTP polling for /socket.io/* ---
  ProxyPass        "/socket.io/"  "http://127.0.0.1:4003/socket.io/"
  ProxyPassReverse "/socket.io/"  "http://127.0.0.1:4003/socket.io/"

  # --- 3) Main web app/API on 4000 ---
  ProxyPass        "/"  "http://127.0.0.1:4000/"
  ProxyPassReverse "/"  "http://127.0.0.1:4000/"

  ErrorLog  ${APACHE_LOG_DIR}/iotrack.live-error.log
  CustomLog ${APACHE_LOG_DIR}/iotrack.live-access.log combined
</VirtualHost>

# https://chatgpt.com/g/g-p-686e447a930881919519cbba2e3aa607-iotrack-live/c/68d048f1-d538-832f-8c35-3b40d2e8853f